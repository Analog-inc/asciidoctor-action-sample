// ドキュメント仕様
:asciidoctor:
:doctype: book
:lang: ja
:icons: font
:encoding: utf-8
:backend: html5
:docinfo: shared
// 画像を埋め込み
:data-uri:
// セクションにアンカーを作成
:sectanchors:
// セクションにリンクを作成
:sectlinks:
// 章番号を付けるか。属性を定義しておくだけで章番号が付けられる。
:sectnums:
// セクションのナンバリングレベルを設定
:sectnumlevels: 5
// ソースコードをハイライトする。
:source-highlighter: coderay

= /.github/workflowsディレクトリの内容について

Github Actionsのワークフローの処理を配置するディレクトリです。

asciidoc.sh:: HTML・PDF・ePubを同時に出力するためのシェルスクリプトです。 +
このファイルには実行権限が必要です。コピーして利用される際はパーミッションの設定を行なった上でリポジトリにPushしてください。
asciidoc.yml:: Github Actionsで実行するワークフローを記述したファイルです。 +
現在は一部のブランチでしか機能しないように制限しています。
azure-static-web-apps-{.*}.yml:: Github Actionsで実行するAzure static web apps向けのワークフローを記述したファイルです。 +
利用するAzure static web appが変更される場合は、Azure static web appsがpushした新たなファイルに本処理をコピーする必要があります。


== branch名による出力制御

workflowsでいつでも好きなドキュメントを出力できるように、branch名による出力制御を行っています。

/master:: masterブランチがpushされると全てのドキュメントをコンバートしAzure static web appsにデプロイします。また画像をHTMLに含まず外部ファイルにします。
/release/:: releaseブランチがpushされるとヘルプデスク向け、h向け、p向けおよびm向けドキュメントをコンバートしAzure static web appsにデプロイします。また画像をHTMLに含まず外部ファイルにします。
/output/:: artifact出力されるようにします。複合的な条件を合わせて利用してください。
/output-artifact/:: PullRequestを行わなくてもartifact出力されるようにします。複合的な条件を合わせて利用してください。

=== 複合的な条件
/html/:: /html/が含まれるbranchにpushされると別途複合条件のドキュメントをコンバートします。
/pdf/:: /pdf/が含まれるbranchにpushされると別途複合条件のドキュメントをコンバートします。
/web/:: /web/が含まれるbranchにがpushされるとコンバート時に画像をHTMLに含まず外部ファイルにします。
/target-h/:: /target-h/が含まれるbranchにpushされるとh向けドキュメントをコンバートします。


== イベントによる出力制御

push:: 上記のbranch名による出力制御が働きます。PullRequestを出した後はsynchronizeイベントとしてでpull_requestビルドを実行します。
pull_request:: Azure static web appsステージング向けの出力が行われます。この際に対象となるのはベースブランチ名です。

Azure static web appsについては
link:https://docs.microsoft.com/ja-jp/azure/static-web-apps/[詳しくはこちら]
